services:
  - type: web
    name: ikap-backend
    # Для использования Docker:
    # 1. В панели Render.com выберите сервис
    # 2. Settings -> Environment -> выберите "Docker"
    # 3. Укажите Dockerfile Path: ./Dockerfile
    # 
    # Если Docker недоступен, используйте buildCommand ниже:
    env: node
    region: oregon
    plan: starter
    buildCommand: |
      npm install &&
      npm run build &&
      python3 --version &&
      cd pdf &&
      sudo python3 -m pip install --upgrade pip setuptools wheel &&
      sudo python3 -m pip install -r requirements.txt &&
      echo "Python dependencies installed successfully (global)"
    startCommand: npm start
    envVars:
      # Обязательные переменные (нужно установить вручную в панели Render)
      - key: OPENAI_API_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      
      # Adobe PDF Services API (обязательно для конвертации PDF)
      - key: ADOBE_CLIENT_ID
        sync: false
      - key: ADOBE_CLIENT_SECRET
        sync: false
      
      # Настройки PDF-сервиса
      # В Docker путь будет /app/pdf, без Docker - /opt/render/project/src/pdf
      - key: PDF_SERVICE_PATH
        value: /opt/render/project/src/pdf
      - key: PYTHON_PATH
        value: python3
      
      # Опциональные настройки
      - key: NODE_ENV
        value: production
      - key: PORT
        generateValue: true
      - key: OPENAI_TIMEOUT_MS
        value: "1200000"
      - key: OPENAI_MAX_RETRIES
        value: "2"

