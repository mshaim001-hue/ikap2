services:
  - type: web
    name: ikap-backend
    # Вариант 1: Использование образа из Docker Hub (рекомендуется)
    dockerImage: mshaim001/ikap2-backend:latest
    #
    # Вариант 2: Сборка из Dockerfile (если dockerImage не указан)
    # dockerfilePath: ./Dockerfile
    # dockerContext: .
    #
    # Вариант 3: Node.js без Docker (если Docker недоступен)
    # env: node
    # buildCommand: |
    #   npm install &&
    #   npm run build &&
    #   python3 --version &&
    #   cd pdf &&
    #   python3 -m pip install --user --upgrade pip setuptools wheel &&
    #   python3 -m pip install --user -r requirements.txt &&
    #   python3 -c "import site; print('User site-packages:', site.getusersitepackages())" &&
    #   echo "Python dependencies installed successfully (--user)"
    # startCommand: npm start
    region: oregon
    plan: starter
    envVars:
      # Обязательные переменные (нужно установить вручную в панели Render)
      - key: OPENAI_API_KEY
        sync: false
      - key: DATABASE_URL
        sync: false
      
      # Adobe PDF Services API (обязательно для конвертации PDF)
      - key: ADOBE_CLIENT_ID
        sync: false
      - key: ADOBE_CLIENT_SECRET
        sync: false
      
      # Настройки PDF-сервиса
      # В Docker путь будет /app/pdf, без Docker - /opt/render/project/src/pdf
      - key: PDF_SERVICE_PATH
        value: /app/pdf
      - key: PYTHON_PATH
        value: python3
      
      # Опциональные настройки
      - key: NODE_ENV
        value: production
      - key: PORT
        generateValue: true
      - key: OPENAI_TIMEOUT_MS
        value: "1200000"
      - key: OPENAI_MAX_RETRIES
        value: "2"

